<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Minecraft Server List</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1e293b, #0f172a);
      color: #f8fafc;
      margin: 0;
    }
    header {
      text-align: center;
      padding: 20px;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    h1 { margin: 0; font-size: 26px; }
    nav { margin-top: 10px; }
    nav a {
      text-decoration: none;
      color: #f8fafc;
      margin: 0 8px;
      font-weight: bold;
    }
    nav a:hover { color: #3b82f6; }
    .btn {
      display: inline-block;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      color: white;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      margin: 4px;
    }
    .banner {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      transition: transform 0.15s;
    }
    .banner:hover { transform: translateY(-3px); }
    .banner img {
      max-width: 100%;
      border-radius: 10px;
    }
    .info { font-size: 14px; color: #d1d5db; margin-top: 8px; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border-radius: 6px;
      border: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>üåç Minecraft Server List</h1>
    <nav>
      <a href="?tab=main">Trang ch·ªß</a>
      <a href="?tab=upload">T·∫°o server</a>
    </nav>
  </header>

  <div class="container" id="content">ƒêang t·∫£i...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getFirestore, collection, getDocs, addDoc, doc, getDoc 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { 
      getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, GithubAuthProvider, FacebookAuthProvider 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // TODO: Thay config c·ªßa b·∫°n
const firebaseConfig = {
  apiKey: "AIzaSyDtcs0XkNhf7yFRTzPY-A9WYet35YjQVT8",
  authDomain: "abc-s-noob.firebaseapp.com",
  databaseURL: "https://abc-s-noob-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "abc-s-noob",
  storageBucket: "abc-s-noob.firebasestorage.app",
  messagingSenderId: "196660846002",
  appId: "1:196660846002:web:ce129820f388cc838658ab",
  measurementId: "G-LG5SWH89MG"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Helper l·∫•y query
    function getQueryParam(key) {
      return new URLSearchParams(window.location.search).get(key);
    }

    async function renderMain() {
      const container = document.getElementById("content");
      container.innerHTML = "<h2>Danh s√°ch Server</h2>";

      const snapshot = await getDocs(collection(db, "servers"));
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "banner";
        div.innerHTML = `
          <a href="?server-id=${docSnap.id}">
            <img src="data:${data.type};base64,${data.image}" alt="Banner">
          </a>
          <div class="info">
            <strong>${data.name}</strong> - ${data.ip}<br>
            Ng∆∞·ªùi upload: ${data.uploadedBy || "·∫®n danh"}
          </div>
        `;
        container.appendChild(div);
      });
    }

    async function renderUpload() {
      const container = document.getElementById("content");
      container.innerHTML = `
        <h2>T·∫°o Server</h2>
        <form id="uploadForm">
          <input type="text" id="serverName" placeholder="T√™n server" required>
          <input type="text" id="serverIP" placeholder="IP server" required>
          <textarea id="serverDesc" placeholder="M√¥ t·∫£ server" required></textarea>
          <input type="file" id="fileInput" accept="image/*" required>
          <button type="submit" class="btn">Upload</button>
        </form>
        <div id="status"></div>
      `;

      document.getElementById("uploadForm").onsubmit = async (e) => {
        e.preventDefault();
        const user = auth.currentUser || await signInAnonymously(auth);

        const file = document.getElementById("fileInput").files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async () => {
          const base64Data = reader.result.split(",")[1];
          await addDoc(collection(db, "servers"), {
            name: document.getElementById("serverName").value,
            ip: document.getElementById("serverIP").value,
            desc: document.getElementById("serverDesc").value,
            image: base64Data,
            type: file.type,
            uid: user.uid,
            uploadedBy: user.isAnonymous ? "Kh√°ch" : (user.displayName || user.email),
            uploadedAt: new Date()
          });
          document.getElementById("status").innerText = "‚úÖ T·∫°o server th√†nh c√¥ng!";
        };
        reader.readAsDataURL(file);
      };
    }

    async function renderServer(id) {
      const container = document.getElementById("content");
      const docRef = doc(db, "servers", id);
      const snap = await getDoc(docRef);

      if (!snap.exists()) {
        container.innerHTML = "<p>‚ùå Server kh√¥ng t·ªìn t·∫°i!</p>";
        return;
      }
      const data = snap.data();
      container.innerHTML = `
        <h2>${data.name}</h2>
        <img src="data:${data.type};base64,${data.image}" style="max-width:100%;border-radius:10px;">
        <p><strong>IP:</strong> <span id="ipText">${data.ip}</span> 
          <button class="btn" onclick="navigator.clipboard.writeText('${data.ip}')">üìã Copy</button></p>
        <p><strong>M√¥ t·∫£:</strong> ${data.desc}</p>
        <div class="info">
          Ng∆∞·ªùi upload: ${data.uploadedBy}<br>
          L√∫c: ${data.uploadedAt?.toDate ? data.uploadedAt.toDate().toLocaleString() : ""}
        </div>
      `;
    }

    // Router logic
    const tab = getQueryParam("tab");
    const serverId = getQueryParam("server-id");
    if (serverId) {
      renderServer(serverId);
    } else if (tab === "upload") {
      renderUpload();
    } else {
      renderMain();
    }
  </script>
</body>
</html>
